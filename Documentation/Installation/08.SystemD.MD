# Configuration des services :

----------------------------------------------------------------------------------------------------------------
### I . Désactivation des services (Précaution)

```bash
systemctl disable NetworkManager ;
systemctl disable systemd-networkd ;
systemctl disable systemd-resolved ;
systemctl disable wpa_supplicant ;
systemctl disable wpa_supplicant@wlan0 ;
systemctl disable wpa_supplicant@eth0 ;
systemctl disable iwd ;
systemctl disable ntpd ; 
```


----------------------------------------------------------------------------------------------------------------
### II. Configuration et activation du Service de résolution DNS (Resolved)

##### A. Configuration ( /etc/systemd/resolved.conf )
```bash
[Resolve]
DNS=192.168.1.1
DNS=192.168.1.40
Domains=lan
```

#### B. Création du Liens
```bash
rm /etc/resolv.conf ;
ln -s /etc/systemd/resolved.conf /etc/resolv.conf ;
```

#### C. Activation du service
```bash
systemctl enable systemd-resolved ;
```

----------------------------------------------------------------------------------------------------------------
### III. Configuration et activation du service Systemd-NetworkD :

##### A. Création du dossier network:
```bash
mkdir /etc/systemd/network ;
```

##### B. Configuration en WI-FI ( /etc/systemd/network/20-wlan0.network )

```bash
[Match]
Name=wlan0

[Network]
DHCP=no
Address=192.168.1.7
Gateway=192.168.1.1
DNS=192.168.1.1
DNS=192.168.1.40
Domains=lan

# IPV6 : OFF
LinkLocalAddressing=no
IPv6AcceptRA=no
```

##### C. Configuration en Ethernet ( /etc/systemd/network/20-eth0.network )

```bash
[Match]
Type=ether

[Network]
LinkLocalAddressing=ipv4
DHCP=ipv4
```

##### D. Activation du service
```bash
systemctl enable systemd-networkd ;
```

----------------------------------------------------------------------------------------------------------------
### III. Configuration et activation du service  wpa_supplicant 

##### A. Configuration du service ( /etc/wpa_supplicant/wpa_supplicant-wlan0.conf )

WPA2-PSK :
```bash
ctrl_interface=/var/run/wpa_supplicant
ctrl_interface_group=0
eapol_version=2
ap_scan=1
fast_reauth=1
network={
	SSID="NOM_DE_MON_RESEAU"
	psk="MACLESECRETE"
	priority=5
	}
```

##### B. Convertir la Clé en HASH

```bash
wpa_passphrase <SSID> <mapassphrase> >> /etc/wpa_supplicant/wpa_supplicant-wlan0.conf ;
```

##### C. Activation du service
```bash
systemctl enable wpa_supplicant@wlan0 ;
```

----------------------------------------------------------------------------------------------------------------
#### X. Activation du SSH
```bash
systemctl enable sshd ;
```

----------------------------------------------------------------------------------------------------------------
#### X. Activation du Plannificateur de tâches
```bash
systemctl enable cronie ;
```

----------------------------------------------------------------------------------------------------------------
#### X. Activation du Horloge
```bash
systemctl enable systemd-timesyncd.service ; 
```

----------------------------------------------------------------------------------------------------------------
#### X. Activation du Son
```bash
systemctl --user enable pipewire ;
```
----------------------------------------------------------------------------------------------------------------
#### X. Activation du Gestionnaire de Session
```bash
systemctl enable sddm ;
```


**Expérimental**
```
ln -s '/usr/lib/systemd/system/sddm.service' '/etc/systemd/system/display-manager.service' ;
systemct enable display-manager.service ;
```


----------------------------------------------------------------------------------------------------------------
#### X. Vérification des services: 

```bash
systemctl status systemd-resolved ;
systemctl status systemd-networkd ;

systemctl status wpa_supplicant@wlan0 ;
systemctl status wpa_supplicant ;
```



----------------------------------------------------------------------------------------------------------------
#### X. Optimisation des services via des timers.

```
systemctl edit --force --full systemd-user-sessions.timer ;
systemctl edit --force --full systemd-resolved.timer ;
```

```bash
[Unit]
Description= Ralentir le lancement du service.

[Timer]
OnBootSec=5sec

[Install]
WantedBy=timers.target
```

```
systemctl enable --now systemd-user-sessions.timer ;
systemctl enable --now systemd-resolved.timer ;


systemctl disable --now systemd-user-sessions.timer ;
systemctl disable --now systemd-resolved.timer ;
```



----------------------------------------------------------------------------------------------------------------
**Observation**
```bash
#################################################################################################################
# Etat des services actif pendant l'installation #
##################################################
systemctl list-unit-files | grep enabled ;
systemctl | grep running ;


getty@.service                             enabled         enabled
netplan-ovs-cleanup.service                enabled-runtime disabled
systemd-fsck-root.service                  enabled-runtime disabled
systemd-homed-activate.service             enabled         disabled
systemd-homed.service                      enabled         enabled
systemd-networkd-wait-online.service       enabled         disabled
systemd-networkd.service                   enabled         enabled
systemd-pstore.service                     disabled        enabled
systemd-remount-fs.service                 enabled-runtime disabled
systemd-resolved.service                   enabled         enabled
systemd-timesyncd.service                  enabled         enabled
systemd-networkd.socket                    enabled         disabled
systemd-userdbd.socket                     enabled         enabled
machines.target                            disabled        enabled
reboot.target                              disabled        enabled
remote-cryptsetup.target                   disabled        enabled
remote-fs.target                           enabled         enabled
systemd-networkd-wait-online.service
systemd-homed.service
iwd.service                                enabled         disabled
```

----------------------------------------------------------------------------------------------------------------


[SystemD](https://wiki.archlinux.fr/systemd)
[SystemD-NetworkD](https://wiki.archlinux.fr/systemd-networkd)
[Config NetworkD](https://www.moyens.net/linux/comment-configurer-systemd-networkd-sur-linux/)
[Spoofer l'interface](https://unix.stackexchange.com/questions/501928/systemd-set-mac-address-and-ip-address)

