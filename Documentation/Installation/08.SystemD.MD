# Configuration des services :

----------------------------------------------------------------------------------------------------------------
### I . Désactivation des services (Précaution)

```bash
systemctl disable NetworkManager ;
systemctl disable systemd-networkd ;
systemctl disable systemd-resolved ;
systemctl disable wpa_supplicant ;
systemctl disable wpa_supplicant@wlan0 ;
systemctl disable wpa_supplicant@eth0 ;
systemctl disable iwd ;
systemctl disable ntpd ; 
```


### II. Activation du service Home.

````bash
systemctl enable systemd-homed ;
```` 


#### III. Activation du Horloge
```bash
systemctl enable systemd-timesyncd.service ; 
```





----------------------------------------------------------------------------------------------------------------
### IV. Configuration et activation du Service de résolution DNS (Resolved)

##### A. Configuration ( /etc/systemd/resolved.conf )
```bash
[Resolve]
DNS=192.168.1.1
DNS=192.168.1.40
Domains=lan
```

#### B. Création du Liens
```bash
rm /etc/resolv.conf ;
ln -s /etc/systemd/resolved.conf /etc/resolv.conf ;
```

#### C. Activation du service
```bash
systemctl enable systemd-resolved ;
```

----------------------------------------------------------------------------------------------------------------
### V. Configuration et activation du service Systemd-NetworkD :

##### A. Création du dossier network:
```bash
mkdir /etc/systemd/network ;
```


##### B. Loopback ( /etc/systemd/network/lo.network )
```
[Match]
Name=lo

[Link]
RequiredForOnline=yes

[RoutingPolicyRule]
FirewallMark=300
Table=100
Family=ipv4

[Route]
Table=100
Destination=0.0.0.0/0
Type=local
```

##### C. Configuration en WI-FI ( /etc/systemd/network/20-wlan0.network )

```bash
[Match]
Name=wlan0

[Network]
DHCP=no
Address=192.168.1.7/24
Gateway=192.168.1.1
DNS=192.168.1.1
DNS=192.168.1.40
Domains=lan

# IPV6 : OFF
LinkLocalAddressing=no
IPv6AcceptRA=no
```

##### D. Configuration en Ethernet ( /etc/systemd/network/20-eth0.network )

```bash
[Match]
Type=ether

[Network]
LinkLocalAddressing=ipv4
DHCP=ipv4
```

##### E. Activation du service
```bash
systemctl enable systemd-networkd ;
```

----------------------------------------------------------------------------------------------------------------
### VI. Configuration et activation du service  wpa_supplicant 

##### A. Configuration du service ( /etc/wpa_supplicant/wpa_supplicant-wlan0.conf )

WPA2-PSK :
```bash
ctrl_interface=/var/run/wpa_supplicant
ctrl_interface_group=0
eapol_version=2
ap_scan=1
fast_reauth=1
network={
	SSID="NOM_DE_MON_RESEAU"
	psk="MACLESECRETE"
	priority=5
	}
```

##### B. Convertir la Clé en HASH

```bash
wpa_passphrase <SSID> <mapassphrase> >> /etc/wpa_supplicant/wpa_supplicant-wlan0.conf ;
```

##### C. Activation du service wpa_supplicant
```bash
systemctl enable wpa_supplicant@wlan0 ;
```

----------------------------------------------------------------------------------------------------------------
#### VII. Activation du SSH
```bash
systemctl enable sshd ;
```

----------------------------------------------------------------------------------------------------------------
#### VIII. Activation du Gestionnaire de Session
```bash
systemctl enable sddm ;
```
----------------------------------------------------------------------------------------------------------------

#### IX. Activation du service liée au Son
```bash
systemctl --user enable pipewire ;
```

----------------------------------------------------------------------------------------------------------------
#### X. Activation du Plannificateur de tâches
```bash
systemctl enable cronie ;
```


----------------------------------------------------------------------------------------------------------------
#### X. Activation des autres services
```bash
```




----------------------------------------------------------------------------------------------------------------
#### XI. Optimisation des services via des timers.

```
systemctl edit --force --full systemd-user-sessions.timer ;
systemctl edit --force --full systemd-resolved.timer ;
```

```bash
[Unit]
Description= Ralentir le lancement du service.

[Timer]
OnBootSec=5sec

[Install]
WantedBy=timers.target
```

```
systemctl enable --now systemd-user-sessions.timer ;
systemctl enable --now systemd-resolved.timer ;

systemctl disable --now systemd-user-sessions.timer ;
systemctl disable --now systemd-resolved.timer ;
```

----------------------------------------------------------------------------------------------------------------
#### XII. Vérification des services: 

```bash
systemctl status cronie ;
systemctl status sddm ;
systemctl status sshd ;
systemctl status systemd-homed ;
systemctl status systemd-timesyncd.service ;
systemctl status systemd-resolved ;
systemctl status systemd-networkd ;
systemctl status wpa_supplicant@wlan0 ;
systemctl status pipewire ;
systemctl status display-manager.service ;

systemctl list-unit-files --state=enabled ;
systemctl list-unit-files --state=disabled ;
```













----------------------------------------------------------------------------------------------------------------
**Observation**
```bash
#################################################################################################################
# Etat des services actif pendant l'installation #
##################################################
systemctl list-unit-files | grep enabled ;
systemctl | grep running ;


getty@.service                             enabled         enabled
netplan-ovs-cleanup.service                enabled-runtime disabled
systemd-fsck-root.service                  enabled-runtime disabled
systemd-homed-activate.service             enabled         disabled
systemd-homed.service                      enabled         enabled
systemd-networkd-wait-online.service       enabled         disabled
systemd-networkd.service                   enabled         enabled
systemd-pstore.service                     disabled        enabled
systemd-remount-fs.service                 enabled-runtime disabled
systemd-resolved.service                   enabled         enabled
systemd-timesyncd.service                  enabled         enabled
systemd-networkd.socket                    enabled         disabled
systemd-userdbd.socket                     enabled         enabled
machines.target                            disabled        enabled
reboot.target                              disabled        enabled
remote-cryptsetup.target                   disabled        enabled
remote-fs.target                           enabled         enabled
systemd-networkd-wait-online.service
systemd-homed.service
iwd.service                                enabled         disabled
```

----------------------------------------------------------------------------------------------------------------
#### X. Optimisation des services via des timers.

[root@archlinux ~]# 


**Expérimental**
```
ln -s '/usr/lib/systemd/system/sddm.service' '/etc/systemd/system/display-manager.service' ;
systemct enable display-manager.service ;
```




----------------------------------------------------------------------------------------------------------------


[SystemD](https://wiki.archlinux.fr/systemd)
[SystemD-NetworkD](https://wiki.archlinux.fr/systemd-networkd)
[Config NetworkD](https://www.moyens.net/linux/comment-configurer-systemd-networkd-sur-linux/)
[Spoofer l'interface](https://unix.stackexchange.com/questions/501928/systemd-set-mac-address-and-ip-address)

